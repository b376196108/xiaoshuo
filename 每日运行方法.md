改完以后，你每天怎么用（最省事）
1）一键准备今天的写作目录（自动 ch002/ch003… + 自动 goals + 默认 3200+）

在仓库根目录运行：

scripts\prepare_next.bat


它会自动生成/更新：

runs/YYYY-MM-DD/brief.md（chapter_goals 自动填好）

runs/YYYY-MM-DD/context_pack.md

runs/YYYY-MM-DD/manual_codex_instructions.md

2）打开 manual_codex_instructions.md，按 Step1-3 让 VSCode Codex 生成章纲/正文/归档
3）你再跑 QA + PASS 才 merge
python tools/continuity_checks.py --date YYYY-MM-DD --chapter chNNN
python tools/merge_state_patch.py --date YYYY-MM-DD

你想要的“goal 自动生成”会长什么样（示例，ch002）

基于你当前 state/open_loops，大概率会类似：

承接上章钩子：明卯点名集合，林家必须保住关键劳力不被带走

推进 loop_labor_levy：摸清名册口径/争取缓冲或替代方案

推进 loop_neighbor_sabotage：压住流言扩散，拿到反制证据或当众反击

种田爽点落地：用现代方法解决“更顶饱的一餐/省柴/换粮路径”的一个突破

磨难/反转升级：里正/差役临时加码或井水事件爆发，迫使下一步行动

准备下一章（PowerShell 推荐）：

- 运行命令（注意必须带 .\\ 前缀）：
  .\scripts\prepare_next.bat --date 2025-12-20


方案 1（推荐）：用 Python 入口（不依赖 scripts 目录）
python tools/prepare_next_run.py --date 2025-12-21


执行后你应该看到它创建（或更新）类似这些文件：

runs/2025-12-21/brief.md

runs/2025-12-21/context_pack.md

runs/2025-12-21/manual_codex_instructions.md

runs/2025-12-21/qa_report.md（此时通常是 FAIL，因为正文等还没生成，正常）

并且它会自动推断下一章：

chapter_id = ch002

target_words >= 3200（你们已做硬规则）

你要“测试生成 ch002”，就用今天/明天任意日期都行。日期只影响 runs 目录，不影响章节编号递增逻辑（章节号主要看 state）。

二、让 Codex 生成 ch002（执行步骤）

打开：

runs/2025-12-21/manual_codex_instructions.md

按里面的 Step1-3 在 VSCode Codex 扩展里执行，让它生成这些关键文件：

runs/2025-12-21/chapter_plan.md

manuscript/ch002.md（第 1 行 # ch002，第 2 行必须 ## 《标题》）

recap/chapter_summaries/ch002.md

recap/rolling_recap.md

state/state_patch.json

runs/2025-12-21/changelog.md

三、QA + 合并（只有 PASS 才合并）
1）跑 QA
python tools/continuity_checks.py --date 2025-12-21 --chapter ch002


确保 runs/2025-12-21/qa_report.md 第一行是：

QA_RESULT: PASS

2）合并 state_patch
python tools/merge_state_patch.py --date 2025-12-21