# 新开小说说明书

本说明用于在本仓库内“重置并启动一部新小说”的基础配置。目标是让新题材/新设定在后续流水线里保持一致、可复用、可验证。

## 一、开始前必读
- 所有文档统一使用 UTF-8（无 BOM），换行使用 LF。
- 章节编号统一为字符串格式 `chNNN`（如 `ch001`）。
- 唯一输入真相源为 `inputs/project_brief.json`（严格 JSON）。
- `inputs/project_brief.yaml` 仅作可读镜像，不参与程序逻辑。

## 二、必须修改的基础文档（按顺序）

### 1) 项目输入配置
1. `inputs/project_brief.json`
   - 更新题材、基调、受众尺度、核心钩子、主题、世界设定锚点。
   - 更新 `scale.total_chapters` 与 `scale.words_per_chapter`。
   - 保持严格 JSON，不写注释、不写占位符。

### 2) 核心设定与风格
2. `canon/premise.md`
   - 一句话世界观 + 核心冲突 + 主角动机。
   - 明确“不可突破规则”（资源、技术、社会秩序）。
3. `canon/style/style_guide.md`
   - 固定 POV、人称、时态、章节结构。
   - 强调标题格式：正文第一行 `# chNNN`，第二行 `## 《标题》`。
4. `canon/rules/world_rules.md`
   - 写清“硬规则”：资源稀缺、交易成本、政务规则、工具材料限制。

### 3) 角色、地点、势力
5. `canon/characters/characters.yaml`
   - 至少 10 个角色，字段包含：`id/name/aliases/goal/flaw/secret/arc/relationships/status/location/knowledge_flags`。
6. `canon/locations/locations.yaml`
   - 至少 10 个地点，包含 `atmosphere` 与 `rules`。
7. `canon/factions/factions.yaml`
   - 至少 3 个势力，包含 `motive/resources/public_face/secret`。

### 4) 故事结构与状态
8. `outline/master_outline.md`
   - 明确总章数与三幕结构。
   - 写出每 10 章里程碑与前 10 章拍表。
9. `state/current_state.json`
   - `meta.current_chapter` 设置为 `ch001`，并与 `project_brief.json` 的总章数/字数一致。
   - 初始化角色状态（位置/目标/状态/知识标记）。
   - `open_loops` 至少 2 条，`id` 必须 ASCII，含 `planned_payoff_window`。

## 三、可选但建议检查的提示词与规范
如需调整写作风格或强化规则，可检查以下文件（只做与新题材一致的改动）：
- `prompts/roles/chapter_planner.md`
- `prompts/roles/drafter.md`
- `prompts/roles/line_editor.md`
- `prompts/roles/archivist.md`
- `prompts/roles/punch_up_editor.md`

## 四、启动新书的推荐流程
1. 完成以上基础文档修改后，运行每日准备：
   - `python tools/prepare_next_run.py --date YYYY-MM-DD`
2. 按 `runs/YYYY-MM-DD/manual_codex_instructions.md` 的 Step1–Step3 生成章纲、正文、归档。
3. 运行 QA：
   - `python tools/continuity_checks.py --date YYYY-MM-DD --chapter ch001`
4. QA 通过后合并状态：
   - `python tools/merge_state_patch.py --date YYYY-MM-DD`

## 五、快速检查清单
- `inputs/project_brief.json` 可被 `json` 解析。
- `state/current_state.json` 与 `outline/master_outline.md` 的总章数一致。
- `chapter_title` 与正文标题格式一致。
- `open_loops` 在章纲、摘要、state_patch 中可一一对齐。
